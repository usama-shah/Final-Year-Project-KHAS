<?php
   $Cityarray = array ( 0 => 'Islamabad', 1 => 'Ahmed Nager', 2 => 'Ahmadpur East', 3 => 'Ali Khan', 4 => 'Alipur', 5 => 'Arifwala', 6 => 'Attock', 7 => 'Bhera', 8 => 'Bhalwal', 9 => 'Bahawalnagar', 10 => 'Bahawalpur', 11 => 'Bhakkar', 12 => 'Burewala', 13 => 'Chillianwala', 14 => 'Chakwal', 15 => 'Chichawatni', 16 => 'Chiniot', 17 => 'Chishtian', 18 => 'Daska', 19 => 'Darya Khan', 20 => 'Dera Ghazi', 21 => 'Dhaular', 22 => 'Dina', 23 => 'Dinga', 24 => 'Dipalpur', 25 => 'Faisalabad', 26 => 'Fateh Jhang', 27 => 'Ghakhar Mandi', 28 => 'Gojra', 29 => 'Gujranwala', 30 => 'Gujrat', 31 => 'Gujar Khan', 32 => 'Hafizabad', 33 => 'Haroonabad', 34 => 'Hasilpur', 35 => 'Haveli', 36 => 'Lakha', 37 => 'Jalalpur', 38 => 'Jattan', 39 => 'Jampur', 40 => 'Jaranwala', 41 => 'Jhang', 42 => 'Jhelum', 43 => 'Kalabagh', 44 => 'Karor Lal', 45 => 'Kasur', 46 => 'Kamalia', 47 => 'Kamoke', 48 => 'Khanewal', 49 => 'Khanpur', 50 => 'Kharian', 51 => 'Khushab', 52 => 'Kot Adu', 53 => 'Jauharabad', 54 => 'Lahore', 55 => 'Lalamusa', 56 => 'Layyah', 57 => 'Liaquat Pur', 58 => 'Lodhran', 59 => 'Malakwal', 60 => 'Mamoori', 61 => 'Mailsi', 62 => 'Mandi Bahauddin', 63 => 'mian Channu', 64 => 'Mianwali', 65 => 'Multan', 66 => 'Murree', 67 => 'Muridke', 68 => 'Mianwali Bangla', 69 => 'Muzaffargarh', 70 => 'Narowal', 71 => 'Okara', 72 => 'Renala Khurd', 73 => 'Pakpattan', 74 => 'Pattoki', 75 => 'Pir Mahal', 76 => 'Qaimpur', 77 => 'Qila Didar', 78 => 'Rabwah', 79 => 'Raiwind', 80 => 'Rajanpur', 81 => 'Rahim Yar', 82 => 'Rawalpindi', 83 => 'Sadiqabad', 84 => 'Safdarabad', 85 => 'Sahiwal', 86 => 'Sangla Hill', 87 => 'Sarai Alamgir', 88 => 'Sargodha', 89 => 'Shakargarh', 90 => 'Sheikhupura', 91 => 'Sialkot', 92 => 'Sohawa', 93 => 'Soianwala', 94 => 'Siranwali', 95 => 'Talagang', 96 => 'Taxila', 97 => 'Toba Tek', 98 => 'Vehari', 99 => 'Wah Cantonment', 100 => 'Wazirabad', 101 => 'Badin', 102 => 'Bhirkan', 103 => 'Rajo Khanani', 104 => 'Chak', 105 => 'Dadu', 106 => 'Digri', 107 => 'Diplo', 108 => 'Dokri', 109 => 'Ghotki', 110 => 'Haala', 111 => 'Hyderabad', 112 => 'Islamkot', 113 => 'Jacobabad', 114 => 'Jamshoro', 115 => 'Jungshahi', 116 => 'Kandhkot', 117 => 'Kandiaro', 118 => 'Karachi', 119 => 'Kashmore', 120 => 'Keti Bandar', 121 => 'Khairpur', 122 => 'Kotri', 123 => 'Larkana', 124 => 'Matiari', 125 => 'Mehar', 126 => 'Mirpur Khas', 127 => 'Mithani', 128 => 'Mithi', 129 => 'Mehrabpur', 130 => 'Moro', 131 => 'Nagarparkar', 132 => 'Naudero', 133 => 'Naushahro Feroze', 134 => 'Naushara', 135 => 'Nawabshah', 136 => 'Nazimabad', 137 => 'Qambar', 138 => 'Qasimabad', 139 => 'Ranipur', 140 => 'Ratodero', 141 => 'Rohri', 142 => 'Sakrand', 143 => 'Sanghar', 144 => 'Shahbandar', 145 => 'Shahdadkot', 146 => 'Shahdadpur', 147 => 'Shahpur Chakar', 148 => 'Shikarpaur', 149 => 'Sukkur', 150 => 'Tangwani', 151 => 'Tando Adam', 152 => 'Tando Allahyar', 153 => 'Tando Muhammad', 154 => 'Thatta', 155 => 'Umerkot', 156 => 'Warah', 157 => 'Abbottabad', 158 => 'Adezai', 159 => 'Alpuri', 160 => 'Akora Khattak', 161 => 'Ayubia', 162 => 'Banda Daud', 163 => 'Bannu', 164 => 'Batkhela', 165 => 'Battagram', 166 => 'Birote', 167 => 'Chakdara', 168 => 'Charsadda', 169 => 'Chitral', 170 => 'Daggar', 171 => 'Dargai', 172 => 'Darya Khan', 173 => 'dera Ismail', 174 => 'Doaba', 175 => 'Dir', 176 => 'Drosh', 177 => 'Hangu', 178 => 'Haripur', 179 => 'Karak', 180 => 'Kohat', 181 => 'Kulachi', 182 => 'Lakki Marwat', 183 => 'Latamber', 184 => 'Madyan', 185 => 'Mansehra', 186 => 'Mardan', 187 => 'Mastuj', 188 => 'Mingora', 189 => 'Nowshera', 190 => 'Paharpur', 191 => 'Pabbi', 192 => 'Peshawar', 193 => 'Saidu Sharif', 194 => 'Shorkot', 195 => 'Shewa Adda', 196 => 'Swabi', 197 => 'Swat', 198 => 'Tangi', 199 => 'Tank', 200 => 'Thall', 201 => 'Timergara', 202 => 'Tordher', 203 => 'Awaran', 204 => 'Barkhan', 205 => 'Chagai', 206 => 'Dera Bugti', 207 => 'Gwadar', 208 => 'Harnai', 209 => 'Jafarabad', 210 => 'Jhal Magsi', 211 => 'Kacchi', 212 => 'Kalat', 213 => 'Kech', 214 => 'Kharan', 215 => 'Khuzdar', 216 => 'Killa Abdullah', 217 => 'Killa Saifullah', 218 => 'Kohlu', 219 => 'Lasbela', 220 => 'Lehri', 221 => 'Loralai', 222 => 'Mastung', 223 => 'Musakhel', 224 => 'Nasirabad', 225 => 'Nushki', 226 => 'Panjgur', 227 => 'Pishin valley', 228 => 'Quetta', 229 => 'Sherani', 230 => 'Sibi', 231 => 'Sohbatpur', 232 => 'Washuk', 233 => 'Zhob', 234 => 'Ziarat', );

   ?>
@extends('UserViews/Layout.layout')
@section('title','Profile Settings')
@section('style')
@endsection
@section('content')
<section class="checkout-wrapper section col-12 pt-4 pb-4 ">
   <div class="container">
      <div class="row justify-content-center ">
         <div class="container pb-5 mb-2 mb-md-4">
            <div class="row">
               <!-- Sidebar-->
               @include('UserViews/Profile/Components/sidebar')
               <!-- Content  -->
               <section class="col-lg-9  px-4 pb-4 mb-3">
                  <div class="pt-3 d-sm-flex flex-wrap bg-white shadow rounded-3 px-3 py-2 justify-content-between align-items-center border-bottom">
                     <h2 class="h3 py-2 me-2 text-center text-sm-start">Settings</h2>
                  </div>
                  <div class="mt-5">
                     <!-- Tabs-->
                     <ul class="nav nav-tabs nav-justified" role="tablist">
                        <li class="nav-item" role="presentation"><a class="nav-link px-0 active" href="#profile" data-bs-toggle="tab"  role="tab" aria-selected="false" >
                           <i class="bi bi-person opacity-60 me-2"></i>Profile
                           </a>
                        </li>
                        <li class="nav-item" role="presentation"><a class="nav-link px-0 " href="#Address" data-bs-toggle="tab" role="tab" aria-selected="true" tabindex="-1">
                           <i class="bi bi-geo-alt opacity-60 me-2"></i>Address
                           </a>
                        </li>
                        <li class="nav-item" role="presentation"><a class="nav-link px-0" href="#payment" data-bs-toggle="tab" role="tab" aria-selected="false" tabindex="-1">
                           <i class="bi bi-credit-card opacity-60 me-2"></i>Payment Methods
                           </a>
                        </li>
                     </ul>
                     <!-- Tab content-->
                     <div class="tab-content">
                        <!-- Profile-->
                        <div class="tab-pane fade active show" id="profile" role="tabpanel">
                          <form method="POST" action="{{ route('profile_settings.update') }}" enctype="multipart/form-data">
                            @csrf

                            <div class="rounded-3 p-4 mb-4">
                                <div class="d-flex align-items-center">
                                  <img class="rounded" src="{{ !empty($user->photo) ? $user->photo : asset('storage/profile_photos/default_profile_photo.jpg') }}" width="90" alt="Profile Photo">
                                  <div class="ps-3">
                                        <label for="file-input" class="btn btn-dark btn-shadow btn-sm mb-2">
                                            <i class="bi bi-upload text-light"></i> Change Profile
                                        </label><span id="file-selected"></span>
                                        <div class="p mb-0 fs-ms text-muted">Recommended Size 1:1</div>
                                        <input id="file-input" onchange="fileSelected()" type="file" hidden accept=".jpg,.png" name="photo">
                                    </div>
                                </div>
                            </div>

                            <div class="row gx-4 gy-3">
                                <div class="col-sm-6">
                                    <label class="form-label" for="userid">User ID</label>
                                    <input class="form-control" type="text" id="userid" readonly disabled value="{{ $user->id }}">
                                </div>
                                <div class="col-sm-6">
                                    <label class="form-label" for="first-name">First Name</label>
                                    <input class="form-control" type="text" id="first-name" name="first_name" value="{{ $user->first_name }}">
                                </div>
                                <div class="col-sm-6">
                                    <label class="form-label" for="last-name">Last Name</label>
                                    <input class="form-control" type="text" id="last-name" name="last_name" value="{{ $user->last_name }}">
                                </div>
                                <div class="col-sm-6">
                                    <label class="form-label" for="email">Email address</label>
                                    <input class="form-control" type="email" id="email" name="email" value="{{ $user->email }}">
                                </div>
                                <div class="col-sm-6">
                                    <label class="form-label" for="phone">Phone No</label>
                                    <input class="form-control" type="text" id="phone" name="phone" value="{{ $user->phone }}">
                                </div>
                                <div class="col-12">
                                    <hr class="mt-2 mb-4">
                                    <div class="d-sm-flex justify-content-between align-items-center">
                                        <button type="submit" class="btn btn-primary mt-3 mt-sm-0">Save changes</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                          </div>
                        <!-- Address-->
                        <div class="tab-pane fade mt-4" id="Address" role="tabpanel">
                          <form id="address-form" method="POST" action="{{route('profile_settings.address')}}">
                         @csrf
                            <div class="row">
                              <div class="col-sm-6">
                                 <label class="form-label" for="cities">City</label>
                                 <select style="width:100% !important" class="col-12 form-control" name="city" id="cities">
                                    <option value="" disabled selected>Select The City</option>
                                    <?php foreach ($Cityarray as $city) : ?>
                                    <option value="<?php echo $city; ?>" <?php echo ($city == $user->city) ? 'selected' : ''; ?>><?php echo $city; ?></option>
                                    <?php endforeach; ?>
                                 </select>
                              </div>
                              <div class="col-sm-6">
                                 <label class="form-label" for="address">Address</label>
                                 <input class="form-control" type="text" name="address" id="address" value="{{$user->address}}">
                              </div>
                              <div class="col-sm-6 mt-4">
                                 <label class="form-label" for="zip_code">ZIP Code</label>
                                 <input class="form-control" type="text" name="zip_code" id="zip_code" value="{{$user->zip_code}}">
                              </div>
                              <div class="col-12 mt-4">
                                 <div class="d-sm-flex justify-content-between align-items-center">
                                    <div class="form-check">
                                       <input class="form-check-input" type="checkbox"  name="default_address"id="default-address" @if($user->default_address) checked @endif>
                                       <label class="form-check-label" for="default-address">Set as Default Address</label>
                                    </div>
                                    <button class="btn btn-primary mt-3 mt-sm-0" >Save changes</button>
                                 </div>
                              </div>
                           </div>
                          </form>
                        </div>

                        <!-- Payment methods-->
                        <div class="tab-pane fade mt-4" id="payment" role="tabpanel">
                           <div class="table-responsive fs-md mb-4">
                              <div class="text-sm-end"><a class="btn btn-primary" href="#new-payment" data-bs-toggle="modal">Add New Payment method</a></div>
                              <table id="paymentMethodTable" class="table table-hover mb-0">
                                 <thead>
                                    <tr>
                                       <th>Bank</th>
                                       <th>Account</th>
                                       <th>Added on</th>
                                       <th>Action</th>
                                    </tr>
                                 </thead>
                                 <tbody>
                                    @forelse($authUser->payMethod as $pay)
<tr>
<td>{{$pay->bank_name}}</td>
<td>{{$pay->account_number}}</td>
<td>{{$pay->created_at->format('Y-m-d')}}</td>
<td>
   <a href="{{route('payMethod.remove',$id=$pay->id)}}" class="btn btn-sm btn-danger" data-method-id="{{$pay->id}}"
     onclick="return confirm('Are you sure you want to remove this Withdraw Method?');">
     Remove
   </a>
 </td></tr>
                                    @empty

                                    @endforelse
                                 </tbody>
                              </table>
                           </div>
                        </div>
                     </div>
                  </div>


                  <div class="modal fade" id="new-payment" tabindex="-1" role="dialog" aria-labelledby="new-paymentLabel" aria-hidden="true">
                     <div class="modal-dialog" role="document">
                         <div class="modal-content">
                             <div class="modal-header">
                                 <h5 class="modal-title" id="new-paymentLabel">Add New Payment Method</h5>
                                 <span type="button" class="close" data-dismiss="modal" aria-label="Close">
                                     <span aria-hidden="true">&times;</span>
                                 </span>
                             </div>
                             <div class="modal-body">
                                 <form id="new-payment-form">
                                     <div class="form-group">
                                         <label for="bank-name" class="col-form-label">Bank Name:</label>
                                         <input type="text" class="form-control" id="bank-name">
                                     </div>
                                     <div class="form-group">
                                         <label for="account-number" class="col-form-label">Account Number:</label>
                                         <input type="text" class="form-control" id="account-number">
                                     </div>
                                 </form>
                             </div>
                             <div class="modal-footer">
                                 <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                 <button type="button" class="btn btn-primary" id="save-payment-method">Save</button>
                             </div>
                         </div>
                     </div>
                 </div>

               </section>
            </div>
         </div>
      </div>
   </div>
</section>
@endsection
@section('script')
<script>


   function fileSelected() {
     var input = document.getElementById("file-input");
     var files = input.files;
     var fileSelectedText = document.getElementById("file-selected");
     if(files.length!==0)
     fileSelectedText.innerHTML = files.length + " file(s) selected";
     else
     fileSelectedText.innerHTML ="";

   }
$('#save-payment-method').on('click', function() {
    var bankName = $('#bank-name').val();
    var accountNumber = $('#account-number').val();
    $.ajax({
        url: '/add-payment-method',
        method: 'POST',
        data: {
            bank_name: bankName,
            account_number: accountNumber,
            _token: "{{ csrf_token() }}"
        },
        success: function(response) {
            // handle success
            toastr.success(response.message);
            $('#new-payment').modal('hide');
            // add the new row to the table
    var newRow = `<tr>
        <td>${response.data.bank_name}</td>
        <td>${response.data.account_number}</td>
        <td>${new Date().toISOString().split('T')[0]}</td>
        <td><button class="btn btn-sm btn-danger" data-method-id="${response.data.id}">Remove</button></td>
    </tr>`;

    $('#paymentMethodTable').append(newRow);
        },
        error: function(jqXHR, textStatus, errorThrown) {
            // handle error
            if (jqXHR.status === 422) {
                var errors = jqXHR.responseJSON.errors;
                var errorMessage = '';
                $.each(errors, function (key, value) {
                    errorMessage += value + '<br>';
                });
                toastr.error(errorMessage);
            } else {
                toastr.error('Something went wrong!');
            }
        }
    });
});

</script>
@endsection